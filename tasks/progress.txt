## Codebase Patterns
- Tauri v2 with React 19 + TypeScript frontend
- Tailwind CSS v4 with custom Apple-inspired design tokens in index.css
- Semantic colors via CSS variables: --background, --foreground, --secondary, --accent, --border, --card
- Tauri plugins already installed: dialog, fs, shell
- Use `pnpm run build` (runs tsc && vite build) for frontend typecheck/build
- Use `cargo build` in src-tauri for Rust backend builds
- SF Pro font family set in body CSS
- Components go in src/components/ directory
- Use .drag-region class for titlebar drag areas, .no-drag for buttons inside
- Use `invoke<T>("command", { args })` from `@tauri-apps/api/core` to call Tauri commands
- Register Tauri commands via `.invoke_handler(tauri::generate_handler![cmd1, cmd2])` in lib.rs
- Type definitions go in src/types/ directory, export via index.ts barrel

---

## Initial Setup - PRD Creation
Thread: https://ampcode.com/threads/T-019bab7f-d939-7764-bbdc-58a7742152ce
- Created prd.json with 28 properly-sized user stories
- Stories ordered by dependency: layout → stores → UI components → Tauri commands → build loop
- Each story is scoped to be completable in one iteration
---

## 2026-01-10 - US-001
Thread: https://ampcode.com/threads/T-019bab7f-d939-7764-bbdc-58a7742152ce
- Implemented sidebar layout shell with 3-column structure
- Files changed: src/App.tsx, src/components/Sidebar.tsx, src/components/MainContent.tsx, src/index.css
- **Learnings for future iterations:**
  - Sidebar uses backdrop-blur-xl for vibrancy effect
  - Added .drag-region and .no-drag CSS classes for macOS window dragging
  - Tailwind v4 uses @theme directive for custom color definitions
---

## 2026-01-10 - US-002
Thread: https://ampcode.com/threads/T-019bab84-01eb-758b-9a4b-14253920f7ab
- Installed zustand package (v5.0.9)
- Created src/stores/projectStore.ts with full project state management
- Implemented Project type: { id, name, description, path, status, createdAt }
- Implemented actions: addProject, removeProject, setActiveProject, updateProject
- Files changed: package.json, pnpm-lock.yaml, src/stores/projectStore.ts
- **Learnings for future iterations:**
  - Zustand uses `create<StateType>((set) => ({...}))` pattern in v5
  - Don't include unused `get` parameter in zustand create callback - TypeScript will error
  - Use `crypto.randomUUID()` for generating unique IDs
---

## 2026-01-10 - US-003
Thread: https://ampcode.com/threads/T-019bab85-fb5d-7443-b0e7-b718a89c4b60
- Implemented NewProjectModal component with all required fields
- Files changed: src/components/NewProjectModal.tsx, src/App.tsx
- **Learnings for future iterations:**
  - Modal uses fixed positioning with bg-black/50 overlay for dimming
  - Use `no-drag` class on modal content to prevent window dragging
  - Input focus ring uses `focus:ring-2 focus:ring-accent` pattern
  - Clicking overlay triggers close via `e.target === e.currentTarget` check
---

## 2026-01-10 - US-004
Thread: https://ampcode.com/threads/T-019bab87-c54b-76d6-92ed-1824e47cd5e1
- Implemented directory picker integration using @tauri-apps/plugin-dialog
- Directory picker button now invokes Tauri dialog with directory: true option
- Selected path displayed in modal's directory field
- Default path set to Documents folder using documentDir() from @tauri-apps/api/path
- Files changed: src/components/NewProjectModal.tsx
- **Learnings for future iterations:**
  - Use `open({ directory: true, defaultPath })` from @tauri-apps/plugin-dialog for directory selection
  - Import `documentDir` from `@tauri-apps/api/path` to get Documents folder path
  - Dialog permissions already configured in src-tauri/capabilities/default.json
---

## 2026-01-10 - US-005
Thread: https://ampcode.com/threads/T-019bab89-42b3-763e-958b-50d9eb34d5e0
- Implemented Tauri `create_project` command in Rust
- Command creates project folder with .ideate/ subdirectory and config.json
- Connected frontend to call command on Create button click via `invoke()`
- Project added to Zustand store after successful disk creation
- Modal closes on success
- Files changed: src-tauri/src/lib.rs, src-tauri/Cargo.toml, src/App.tsx
- **Learnings for future iterations:**
  - Use `invoke<ReturnType>("command_name", { args })` from `@tauri-apps/api/core` to call Tauri commands
  - Tauri commands use snake_case on Rust side, frontend uses camelCase for args
  - Added chrono crate for timestamp generation in Rust
  - Register commands via `.invoke_handler(tauri::generate_handler![command_name])` in tauri::Builder
---

## 2026-01-10 - US-006
Thread: https://ampcode.com/threads/T-019bab8c-a1f6-76c1-a1d1-84c43f770bec
- Implemented project list display in Sidebar component
- Added status indicator dots with color mapping: gray (idle), blue (generating), green (ready), red (error)
- Implemented click-to-select with active state highlighting using accent background
- Files changed: src/components/Sidebar.tsx
- **Learnings for future iterations:**
  - Use Record<ProjectStatus, string> for type-safe status color mappings
  - Conditional classes pattern: `${isActive ? 'active-styles' : 'default-styles'}`
  - Import types with `type` keyword for type-only imports
---

## 2026-01-10 - US-007
Thread: https://ampcode.com/threads/T-019bab8d-f694-742b-a946-84e30b92c747
- Created ProjectView component showing project name, description, and empty PRD state
- MainContent now conditionally renders ProjectView when a project is active
- Files changed: src/components/ProjectView.tsx, src/components/MainContent.tsx
- **Learnings for future iterations:**
  - Use `projects.find((p) => p.id === activeProjectId)` to get active project
  - Empty states follow card pattern: rounded-xl border with centered content
  - ProjectView uses max-w-3xl mx-auto for constrained, centered content
---

## 2026-01-10 - US-008
Thread: https://ampcode.com/threads/T-019bab8f-70d2-72c9-8d41-bbeddf543983
- Created src/stores/prdStore.ts with full PRD state management
- Implemented Story type matching Ralph format: { id, title, description, acceptanceCriteria, priority, passes, notes }
- Implemented status tracking: idle/generating/ready/error
- Implemented actions: setStories, updateStory, addStory, removeStory, setStatus
- Files changed: src/stores/prdStore.ts
- **Learnings for future iterations:**
  - Story ID generation uses priority for consistency: `US-${String(priority).padStart(3, '0')}`
  - PrdStore follows same pattern as projectStore with create<StateType>((set) => ({...}))
---

## 2026-01-10 - US-009
Thread: https://ampcode.com/threads/T-019bab90-ce9d-7212-a042-e327d0b5977e
- Created StoryCard component with ID badge, title, truncated description, criteria count, status badge
- Created StoryList component that renders stories from prdStore
- Integrated StoryList into ProjectView (shows story list when stories exist, empty state otherwise)
- Status colors: pending (gray), in-progress (blue), complete (green), failed (red)
- Cards are clickable and log story ID to console
- Files changed: src/components/StoryCard.tsx, src/components/StoryList.tsx, src/components/ProjectView.tsx
- **Learnings for future iterations:**
  - Use `line-clamp-2` for truncating text to 2 lines
  - Status is derived from story.passes: true=complete, false=pending (can be extended later for in-progress/failed)
  - Story status colors use Tailwind opacity pattern: `bg-green-500/20 text-green-500`
---

## 2026-01-10 - US-010
Thread: https://ampcode.com/threads/T-019babb8-a3bc-739d-811a-cd2acfe7bf05
- Implemented expandable story card with full detail view
- Added useState to track expanded/collapsed state
- Expanded view shows: full description, acceptance criteria as visual checklist, notes if present
- Close button (X icon) collapses the card
- Checkmarks display on criteria when story.passes is true
- Files changed: src/components/StoryCard.tsx
- **Learnings for future iterations:**
  - Use useState for local expand/collapse state in cards
  - Visual-only checkboxes use border div with conditional check SVG inside
  - Use e.stopPropagation() on close button to prevent re-triggering card click
---

## 2026-01-10 - US-011
Thread: https://ampcode.com/threads/T-019babba-2983-779e-bc8b-80c1bc167a8f
- Created Tauri `load_prd` command that reads <project>/.ideate/prd.json
- Command returns parsed user stories array or null if file doesn't exist
- Added Story and Prd structs in Rust with proper serde rename attributes for camelCase
- Updated MainContent to call load_prd via useEffect when activeProject changes
- Stories populated in prdStore on successful load, status set to "ready"
- Files changed: src-tauri/src/lib.rs, src/components/MainContent.tsx
- **Learnings for future iterations:**
  - Use #[serde(rename = "camelCase")] for JSON field name mappings in Rust structs
  - load_prd returns Option<Vec<Story>> to handle missing prd.json gracefully
  - useEffect dependency should use activeProject?.path for proper reactive loading
---

## 2026-01-10 - US-012
Thread: https://ampcode.com/threads/T-019babbc-1a71-7648-b5e4-fcda6f7d83dd
- Created Tauri `save_prd` command that writes prd.json to project .ideate folder
- Command takes project_path and stories as arguments
- Added `savePrd` action to prdStore that invokes the Tauri command
- Success/error feedback via console.log/console.error
- Files changed: src-tauri/src/lib.rs, src/stores/prdStore.ts
- **Learnings for future iterations:**
  - Use `get()` in zustand to access current state in async actions
  - save_prd creates .ideate folder if it doesn't exist (fs::create_dir_all)
  - Frontend components should call `savePrd(projectPath)` after modifying stories
---

## 2026-01-10 - US-013
Thread: https://ampcode.com/threads/T-019babbe-7735-721d-bb66-8fd1fd84b598
- Implemented EditStoryModal component with title, description, and acceptance criteria editing
- Added Edit button to expanded StoryCard that opens the modal
- Updated StoryList to manage modal state and handle save/close
- Updated ProjectView to pass projectPath to StoryList for PRD saving
- Files changed: src/components/EditStoryModal.tsx (new), src/components/StoryCard.tsx, src/components/StoryList.tsx, src/components/ProjectView.tsx
- **Learnings for future iterations:**
  - Use useEffect to sync form state with story prop when modal opens
  - StoryList now accepts projectPath prop for saving PRD after edits
  - Filter empty criteria on save: `criteria.filter((c) => c.trim() !== "")`
  - Modal uses max-h-[90vh] overflow-auto for scrollable content on long criteria lists
---

## 2026-01-10 - US-014
Thread: https://ampcode.com/threads/T-019babc0-ca3c-77f3-a67e-972ba5842bda
- Implemented "Add Story" button at bottom of story list
- Created CreateStoryModal component similar to EditStoryModal but for new stories
- Auto-generates next story ID based on highest existing priority + 1
- New story saved to disk automatically via savePrd
- Files changed: src/components/CreateStoryModal.tsx (new), src/components/StoryList.tsx
- **Learnings for future iterations:**
  - CreateStoryModal reuses same patterns as EditStoryModal with empty initial state
  - Use `Math.max(...stories.map((s) => s.priority))` to find highest priority
  - useEffect with isOpen dependency to reset form state when modal opens
---

## 2026-01-10 - US-015
Thread: https://ampcode.com/threads/T-019babc2-c57d-70ea-85a9-a4292ac9d2fc
- Implemented delete button (trash icon) on expanded story card
- Created ConfirmDeleteModal component with 'Delete US-XXX?' confirmation
- Added onDelete prop to StoryCard, wired up delete flow in StoryList
- Delete removes story from store and saves PRD to disk
- Cancel closes dialog and keeps story
- Files changed: src/components/ConfirmDeleteModal.tsx (new), src/components/StoryCard.tsx, src/components/StoryList.tsx
- **Learnings for future iterations:**
  - Use e.stopPropagation() on delete button to prevent card click event
  - Delete button uses red-500/10 hover for danger indication
  - Confirmation modal uses simple pattern: isOpen, storyId, onConfirm, onCancel props
---

## 2026-01-10 - US-016
Thread: https://ampcode.com/threads/T-019babc4-d254-741c-87dc-44c13099969a
- Created src/types/plugin.ts with AgentPlugin interface
- Defined WorkingDirBehavior type: 'project' | 'custom'
- AgentPlugin has: id, name, command, argsTemplate, workingDir
- Created defaultPlugins array with Amp and Claude Code definitions
- Created src/types/index.ts to export all types and default plugins
- Files changed: src/types/plugin.ts (new), src/types/index.ts (new)
- **Learnings for future iterations:**
  - Types go in src/types/ directory with index.ts barrel export
  - Use argsTemplate array with {{prompt}} placeholder for agent CLI args
  - WorkingDirBehavior allows specifying if agent runs from project dir or custom path
---

## 2026-01-10 - US-017
Thread: https://ampcode.com/threads/T-019babc6-3ca1-7422-a8da-6e202eff4a0d
- Implemented AgentSettings component with agent and autonomy level dropdowns
- Created Tauri commands: load_project_settings, save_project_settings
- Settings saved to .ideate/config.json, preserving existing config fields
- Added AgentSettings section to ProjectView above story list
- Files changed: src/components/AgentSettings.tsx (new), src/components/ProjectView.tsx, src-tauri/src/lib.rs
- **Learnings for future iterations:**
  - Use ProjectSettings struct for loading partial config data (agent + autonomy only)
  - Save settings preserves existing config by reading file first, then updating fields
  - Dropdowns use focus:ring-2 focus:ring-accent pattern consistent with other inputs
---

## 2026-01-10 - US-018
Thread: https://ampcode.com/threads/T-019babc8-dc47-7126-91c2-3e7305cfd3a8
- Created src/stores/buildStore.ts with full build loop state management
- Implemented BuildStatus type: 'idle' | 'running' | 'paused'
- Implemented LogEntry interface with id, timestamp, type (stdout/stderr/system), content
- Implemented actions: startBuild, pauseBuild, resumeBuild, cancelBuild, setCurrentStoryId, appendLog, clearLogs
- Files changed: src/stores/buildStore.ts (new)
- **Learnings for future iterations:**
  - Build store follows same zustand pattern as prdStore and projectStore
  - LogEntry uses crypto.randomUUID() for unique IDs and includes timestamp for ordering
  - Added clearLogs action for resetting between builds
---

## 2026-01-10 - US-019
Thread: https://ampcode.com/threads/T-019babca-7894-734f-9637-b783c9bb2587
- Implemented BuildControls component with Start/Pause/Resume/Cancel buttons
- Integrated BuildControls into ProjectView above story list
- Connected buttons to buildStore actions (startBuild, pauseBuild, resumeBuild, cancelBuild)
- Added disabled states: disabled when no stories or all stories complete
- Files changed: src/components/BuildControls.tsx (new), src/components/ProjectView.tsx
- **Learnings for future iterations:**
  - BuildControls renders different button sets based on status via conditional returns
  - Use `stories.some((s) => !s.passes)` to check for incomplete stories
  - Button disabled state uses Tailwind disabled:opacity-50 disabled:cursor-not-allowed
---

## 2026-01-10 - US-020
Thread: https://ampcode.com/threads/T-019babd2-ed23-76ca-9932-e5c01d322bd0
- Created Tauri `spawn_agent` command to spawn CLI processes
- Command accepts executable, args array, and working directory
- Process spawned with stdout/stderr piped for capture
- Returns process_id (UUID v4) for tracking
- Uses lazy_static HashMap to store Child processes for later access
- Added uuid and lazy_static crates to Cargo.toml
- Files changed: src-tauri/src/lib.rs, src-tauri/Cargo.toml
- **Learnings for future iterations:**
  - Use lazy_static! macro with Mutex<HashMap<String, Child>> to store process handles
  - Spawn with Stdio::piped() to enable stdout/stderr capture for streaming
  - uuid::Uuid::new_v4().to_string() generates unique process IDs
  - PROCESSES global stores Child handles for kill_agent and event streaming
---
